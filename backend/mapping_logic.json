{
  "version": "3.0",
  "description": "Unica fonte de verdade para traduzir achados tecnicos em controles ISO 27001. Cobre 15 dominios do Anexo A para spider chart completo. v3.0: adicionadas regras de cross-check TPRA e mapeamento supplier_context.",
  "mappings": [
    {
      "technical_finding": "open_rdp_port",
      "template_id": null,
      "port": 3389,
      "control_id": "C-01",
      "iso_domain": "A.13.1.1",
      "iso_title": "Redes - Controle de acesso a servicos",
      "score_deduction": 400,
      "severity": "critical",
      "recommendation": "Restringir porta 3389 ou usar VPN. Nunca expor RDP diretamente a internet.",
      "cross_check_questions": ["Q-01"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_smb_port",
      "template_id": null,
      "port": 445,
      "control_id": "C-01",
      "iso_domain": "A.13.1.1",
      "iso_title": "Redes - Controle de acesso a servicos",
      "score_deduction": 400,
      "severity": "critical",
      "recommendation": "Bloquear porta 445 para internet. SMB nao deve ser acessivel externamente.",
      "cross_check_questions": ["Q-01"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_database_port_mysql",
      "template_id": null,
      "port": 3306,
      "control_id": "C-01",
      "iso_domain": "A.13.1.1",
      "iso_title": "Redes - Controle de acesso a servicos",
      "score_deduction": 350,
      "severity": "critical",
      "recommendation": "Restringir acesso ao MySQL (3306) via firewall. Usar conexoes privadas.",
      "cross_check_questions": ["Q-01"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_database_port_postgres",
      "template_id": null,
      "port": 5432,
      "control_id": "C-01",
      "iso_domain": "A.13.1.1",
      "iso_title": "Redes - Controle de acesso a servicos",
      "score_deduction": 350,
      "severity": "critical",
      "recommendation": "Restringir acesso ao PostgreSQL (5432) via firewall.",
      "cross_check_questions": ["Q-01"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_database_port_mongo",
      "template_id": null,
      "port": 27017,
      "control_id": "C-01",
      "iso_domain": "A.13.1.1",
      "iso_title": "Redes - Controle de acesso a servicos",
      "score_deduction": 350,
      "severity": "critical",
      "recommendation": "Restringir acesso ao MongoDB (27017). Nunca expor sem autenticacao.",
      "cross_check_questions": ["Q-01"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "expired_ssl",
      "template_id": "ssl-expired-cert",
      "port": null,
      "control_id": "C-02",
      "iso_domain": "A.10.1.1",
      "iso_title": "Criptografia - Certificados digitais",
      "score_deduction": 200,
      "severity": "high",
      "recommendation": "Renovar certificado SSL imediatamente.",
      "cross_check_questions": ["Q-02", "Q-42"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "ssl_expires_soon",
      "template_id": null,
      "port": null,
      "control_id": "C-02",
      "iso_domain": "A.10.1.1",
      "iso_title": "Criptografia - Certificados digitais",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Planejar renovacao do certificado antes da expiracao.",
      "cross_check_questions": ["Q-02"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "weak_tls",
      "template_id": "ssl-tls-version",
      "port": null,
      "control_id": "C-02",
      "iso_domain": "A.10.1.1",
      "iso_title": "Criptografia - TLS",
      "score_deduction": 120,
      "severity": "high",
      "recommendation": "Desabilitar TLS 1.0/1.1. Usar TLS 1.2+ com cipher suites fortes.",
      "cross_check_questions": ["Q-02", "Q-42"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "self_signed_cert",
      "template_id": "ssl-self-signed",
      "port": null,
      "control_id": "C-02",
      "iso_domain": "A.10.1.1",
      "iso_title": "Criptografia - Certificados digitais",
      "score_deduction": 100,
      "severity": "medium",
      "recommendation": "Substituir certificado auto-assinado por CA confiavel.",
      "cross_check_questions": ["Q-02"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "outdated_software",
      "template_id": null,
      "port": null,
      "control_id": "C-03",
      "iso_domain": "A.12.6.1",
      "iso_title": "Vulnerabilidades - Patch management",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Aplicar patches de seguranca conforme processo de gestao de vulnerabilidades.",
      "cross_check_questions": ["Q-03", "Q-27"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "known_cve",
      "template_id": "cve-*",
      "port": null,
      "control_id": "C-03",
      "iso_domain": "A.12.6.1",
      "iso_title": "Vulnerabilidades - CVE conhecida",
      "score_deduction": 150,
      "severity": "high",
      "recommendation": "Aplicar patch para a CVE identificada. Consultar NVD para detalhes.",
      "cross_check_questions": ["Q-03", "Q-27"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "critical_cve",
      "template_id": null,
      "port": null,
      "control_id": "C-03",
      "iso_domain": "A.12.6.1",
      "iso_title": "Vulnerabilidades - CVE critica (CVSS >= 9.0)",
      "score_deduction": 350,
      "severity": "critical",
      "recommendation": "CVE critica com CVSS >= 9.0. Aplicar patch emergencialmente.",
      "cross_check_questions": ["Q-03", "Q-27"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "subdomain_exposure",
      "template_id": null,
      "port": null,
      "control_id": "C-03",
      "iso_domain": "A.12.6.1",
      "iso_title": "Descoberta de ativos - Subdominios expostos",
      "score_deduction": 20,
      "severity": "low",
      "recommendation": "Revisar subdominios expostos e desativar os nao utilizados.",
      "cross_check_questions": ["Q-19"],
      "tpra_stage": "identification"
    },
    {
      "technical_finding": "nuclei_generic",
      "template_id": "*",
      "port": null,
      "control_id": "C-03",
      "iso_domain": "A.12.6.1",
      "iso_title": "Vulnerabilidades - Achado generico Nuclei",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Corrigir vulnerabilidade identificada pelo scanner.",
      "cross_check_questions": ["Q-03"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_dmarc",
      "template_id": null,
      "port": null,
      "control_id": "C-04",
      "iso_domain": "A.13.2.1",
      "iso_title": "Comunicacoes - Anti-phishing (DMARC)",
      "score_deduction": 150,
      "severity": "high",
      "recommendation": "Implementar DMARC com politica p=reject ou p=quarantine.",
      "cross_check_questions": ["Q-04"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "dmarc_none",
      "template_id": null,
      "port": null,
      "control_id": "C-04",
      "iso_domain": "A.13.2.1",
      "iso_title": "Comunicacoes - DMARC em modo permissivo",
      "score_deduction": 100,
      "severity": "high",
      "recommendation": "Alterar politica DMARC de p=none para p=quarantine ou p=reject.",
      "cross_check_questions": ["Q-04"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_spf",
      "template_id": null,
      "port": null,
      "control_id": "C-04",
      "iso_domain": "A.13.2.1",
      "iso_title": "Comunicacoes - SPF ausente",
      "score_deduction": 120,
      "severity": "high",
      "recommendation": "Implementar registro SPF para prevenir spoofing de e-mail.",
      "cross_check_questions": ["Q-04"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_dkim",
      "template_id": null,
      "port": null,
      "control_id": "C-04",
      "iso_domain": "A.13.2.1",
      "iso_title": "Comunicacoes - DKIM ausente",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Configurar DKIM para autenticacao de e-mails enviados.",
      "cross_check_questions": ["Q-04"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_ssh_port",
      "template_id": null,
      "port": 22,
      "control_id": "C-05",
      "iso_domain": "A.9.4.1",
      "iso_title": "Controle de acesso - SSH exposto",
      "score_deduction": 60,
      "severity": "medium",
      "recommendation": "Restringir SSH via firewall ou bastion host. Desabilitar autenticacao por senha.",
      "cross_check_questions": ["Q-05"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_telnet_port",
      "template_id": null,
      "port": 23,
      "control_id": "C-05",
      "iso_domain": "A.9.4.1",
      "iso_title": "Controle de acesso - Telnet (texto claro)",
      "score_deduction": 300,
      "severity": "critical",
      "recommendation": "Desabilitar Telnet. Usar SSH para acesso remoto seguro.",
      "cross_check_questions": ["Q-05", "Q-42"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "open_ftp_port",
      "template_id": null,
      "port": 21,
      "control_id": "C-05",
      "iso_domain": "A.9.4.1",
      "iso_title": "Controle de acesso - FTP (texto claro)",
      "score_deduction": 150,
      "severity": "high",
      "recommendation": "Desabilitar FTP. Usar SFTP ou SCP para transferencia segura.",
      "cross_check_questions": ["Q-05", "Q-42"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_hsts",
      "template_id": "http-missing-security-headers",
      "port": null,
      "control_id": "C-06",
      "iso_domain": "A.12.4.1",
      "iso_title": "Seguranca operacional - Header HSTS ausente",
      "score_deduction": 50,
      "severity": "medium",
      "recommendation": "Configurar Strict-Transport-Security com max-age adequado.",
      "cross_check_questions": ["Q-16"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_csp",
      "template_id": null,
      "port": null,
      "control_id": "C-06",
      "iso_domain": "A.12.4.1",
      "iso_title": "Seguranca operacional - Header CSP ausente",
      "score_deduction": 50,
      "severity": "medium",
      "recommendation": "Implementar Content-Security-Policy para prevenir XSS.",
      "cross_check_questions": ["Q-16"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_x_frame_options",
      "template_id": null,
      "port": null,
      "control_id": "C-06",
      "iso_domain": "A.12.4.1",
      "iso_title": "Seguranca operacional - X-Frame-Options ausente",
      "score_deduction": 40,
      "severity": "medium",
      "recommendation": "Configurar X-Frame-Options: DENY ou SAMEORIGIN para prevenir clickjacking.",
      "cross_check_questions": ["Q-16"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "server_version_exposed",
      "template_id": null,
      "port": null,
      "control_id": "C-06",
      "iso_domain": "A.12.4.1",
      "iso_title": "Seguranca operacional - Versao de servidor exposta",
      "score_deduction": 20,
      "severity": "low",
      "recommendation": "Remover ou ocultar banners de versao de servidor (Server, X-Powered-By).",
      "cross_check_questions": [],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "leaked_credentials",
      "template_id": null,
      "port": null,
      "control_id": "C-10",
      "iso_domain": "A.16.1.1",
      "iso_title": "Resposta a incidentes - Credenciais vazadas",
      "score_deduction": 400,
      "severity": "critical",
      "recommendation": "Revogar credenciais vazadas imediatamente. Investigar extensao do vazamento.",
      "cross_check_questions": ["Q-10", "Q-25"],
      "tpra_stage": "compliance"
    },
    {
      "technical_finding": "exposed_admin_panel",
      "template_id": "exposed-panels-*",
      "port": null,
      "control_id": "C-13",
      "iso_domain": "A.14.2.1",
      "iso_title": "Desenvolvimento seguro - Painel admin exposto",
      "score_deduction": 120,
      "severity": "high",
      "recommendation": "Restringir acesso ao painel administrativo via VPN ou whitelist de IP.",
      "cross_check_questions": ["Q-13", "Q-45"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "directory_listing",
      "template_id": null,
      "port": null,
      "control_id": "C-13",
      "iso_domain": "A.14.2.1",
      "iso_title": "Desenvolvimento seguro - Directory listing habilitado",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Desabilitar directory listing no servidor web.",
      "cross_check_questions": ["Q-13"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "information_disclosure",
      "template_id": null,
      "port": null,
      "control_id": "C-13",
      "iso_domain": "A.14.2.1",
      "iso_title": "Desenvolvimento seguro - Information disclosure",
      "score_deduction": 60,
      "severity": "medium",
      "recommendation": "Corrigir vazamento de informacoes sensiveis (stack traces, config, etc.).",
      "cross_check_questions": ["Q-13"],
      "tpra_stage": "risk_scoring"
    },
    {
      "technical_finding": "missing_privacy_policy",
      "template_id": null,
      "port": null,
      "control_id": "C-14",
      "iso_domain": "A.18.1.1",
      "iso_title": "Compliance - Politica de privacidade ausente",
      "score_deduction": 80,
      "severity": "medium",
      "recommendation": "Publicar politica de privacidade conforme LGPD Art. 9.",
      "cross_check_questions": ["Q-14", "Q-20"],
      "tpra_stage": "compliance"
    },
    {
      "technical_finding": "cookies_without_consent",
      "template_id": null,
      "port": null,
      "control_id": "C-14",
      "iso_domain": "A.18.1.4",
      "iso_title": "Compliance - Cookies sem consentimento",
      "score_deduction": 60,
      "severity": "medium",
      "recommendation": "Implementar banner de consentimento de cookies conforme LGPD.",
      "cross_check_questions": ["Q-14", "Q-20"],
      "tpra_stage": "compliance"
    }
  ],
  "port_map": {
    "21": "open_ftp_port",
    "22": "open_ssh_port",
    "23": "open_telnet_port",
    "445": "open_smb_port",
    "3306": "open_database_port_mysql",
    "3389": "open_rdp_port",
    "5432": "open_database_port_postgres",
    "27017": "open_database_port_mongo"
  },
  "template_id_prefix_map": {
    "ssl-": "C-02",
    "cve-": "C-03",
    "exposed-panels-": "C-13",
    "http-missing-security-headers": "C-06"
  },
  "control_categories": {
    "C-01": {"category": "Seguranca de Rede", "iso_domain": "A.13.1.1"},
    "C-02": {"category": "Criptografia", "iso_domain": "A.10.1.1"},
    "C-03": {"category": "Gestao de Vulnerabilidades", "iso_domain": "A.12.6.1"},
    "C-04": {"category": "Seguranca de E-mail", "iso_domain": "A.13.2.1"},
    "C-05": {"category": "Controle de Acesso", "iso_domain": "A.9.4.1"},
    "C-06": {"category": "Monitoramento", "iso_domain": "A.12.4.1"},
    "C-07": {"category": "Backup e Recuperacao", "iso_domain": "A.12.3.1"},
    "C-08": {"category": "Politicas", "iso_domain": "A.5.1.1"},
    "C-09": {"category": "Pessoas", "iso_domain": "A.7.2.2"},
    "C-10": {"category": "Resposta a Incidentes", "iso_domain": "A.16.1.1"},
    "C-11": {"category": "Continuidade", "iso_domain": "A.17.1.1"},
    "C-12": {"category": "Fornecedores", "iso_domain": "A.15.1.1"},
    "C-13": {"category": "Desenvolvimento Seguro", "iso_domain": "A.14.2.1"},
    "C-14": {"category": "Compliance e Privacidade", "iso_domain": "A.18.1.1"},
    "C-15": {"category": "Seguranca Fisica", "iso_domain": "A.11.1.1"}
  },
  "cross_check_severity_map": {
    "critical_inconsistency": {
      "description": "Contradicao grave: resposta 'Sim' para controle critico contradita por finding critico",
      "impact": "Zera ponto do controle; aplica penalidade critica (Sf <= 500)",
      "example": "Declara controle de acesso para portas criticas, scan encontra RDP aberto"
    },
    "inconsistency": {
      "description": "Contradicao: resposta positiva invalidada por finding",
      "impact": "Ponto do questionario nao conta como atendido",
      "example": "Declara DMARC configurado, scan detecta DMARC ausente"
    },
    "risk_alert": {
      "description": "Possivel discrepancia; maturidade reduzida",
      "impact": "Reducao parcial da nota do controle",
      "example": "Declara TLS forte, scan encontra TLS 1.1 em subdominio"
    }
  },
  "tpra_cross_check_rules": [
    {
      "rule_id": "TPRA-CC-01",
      "description": "Fornecedor declara avaliar terceiros criticos, mas scan detecta portas abertas de fornecedores conhecidos",
      "question_ids": ["Q-12", "Q-51"],
      "finding_types": ["open_rdp_port", "open_smb_port", "open_database_port_mysql", "open_database_port_postgres", "open_database_port_mongo"],
      "severity": "risk_alert",
      "tpra_stage": "identification"
    },
    {
      "rule_id": "TPRA-CC-02",
      "description": "Fornecedor declara plano de resposta a incidentes, mas credenciais vazadas sem notificacao",
      "question_ids": ["Q-10", "Q-25"],
      "finding_types": ["leaked_credentials"],
      "severity": "critical_inconsistency",
      "tpra_stage": "compliance"
    },
    {
      "rule_id": "TPRA-CC-03",
      "description": "Fornecedor declara dados pessoais protegidos, mas scan encontra politica de privacidade ausente",
      "question_ids": ["Q-14", "Q-20", "Q-29"],
      "finding_types": ["missing_privacy_policy", "cookies_without_consent"],
      "severity": "inconsistency",
      "tpra_stage": "compliance"
    },
    {
      "rule_id": "TPRA-CC-04",
      "description": "Fornecedor declara criptografia forte, mas scan detecta TLS fraco ou certificado expirado",
      "question_ids": ["Q-02", "Q-24", "Q-42"],
      "finding_types": ["weak_tls", "expired_ssl", "self_signed_cert"],
      "severity": "inconsistency",
      "tpra_stage": "risk_scoring"
    },
    {
      "rule_id": "TPRA-CC-05",
      "description": "Fornecedor declara SDLC seguro, mas scan encontra paineis admin expostos ou information disclosure",
      "question_ids": ["Q-13", "Q-32", "Q-49"],
      "finding_types": ["exposed_admin_panel", "directory_listing", "information_disclosure"],
      "severity": "inconsistency",
      "tpra_stage": "risk_scoring"
    }
  ]
}
